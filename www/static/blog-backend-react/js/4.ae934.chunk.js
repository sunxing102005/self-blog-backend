(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1024:function(e,t,n){"use strict";n.r(t);n(933);var a=n(243),i=(n(1467),n(251)),r=(n(250),n(9)),o=(n(986),n(245)),l=n(244),s=n(471),c=n(64),u=n(65),f=n(67),d=n(66),p=n(68),h=n(1),m=n.n(h),g=(n(242),n(912)),v=n(501),b=n(943),y=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(f.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={visibleUpload:!1,imageUrl:"",fileList:n.props.defaultFileList,previewImage:"",previewVisible:!1,uploadImg:{},delModalVisible:!1,deleteTitle:"",deletefile:{}},n.handleChange=function(e){console.log("info",e),n.setState({fileList:Object(s.a)(e.fileList)}),"uploading"!==e.file.status&&"done"===e.file.status&&n.setState({uploadImg:Object(l.a)({},e.file.response.data,{uid:e.file.uid})})},n.handlePreview=function(e){n.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})},n.onConfirmUpload=function(){(0,n.props.onOk)(n.state.fileList.map((function(e){return Object(l.a)({},e.response.data,{url:e.response.data.url})})))},n.onRemove=function(e){console.log("params",e);var t="\u786e\u5b9a\u8981\u5220\u9664\u56fe\u7247 ".concat(e.response?e.response.data.orgname:"","\u5417"),a=null;if(e.response)a=Object(l.a)({},e.response.data,{uid:e.uid});else{var i=e.url.indexOf("/uploads"),r=e.url.substring(i);a=Object(l.a)({},e,{url:r}),console.log("deletefile",a)}return n.setState({deletefile:a,deleteTitle:t,delModalVisible:!0}),!1},n.onRemoveConfirm=function(){var e=n.state.deletefile.url;console.log("this.state.deletefile",n.state.deletefile),Object(g.deleteFile)(e).then((function(){n.setState((function(e){var t=0;e.fileList.forEach((function(n,a){console.log("preState.deletefile.uid",e.deletefile.uid),n.uid===e.deletefile.uid&&(t=a)}));var n=Object(s.a)(e.fileList);return n.splice(t,1),{fileList:Object(s.a)(n),delModalVisible:!1}})),o.a.success("\u5220\u9664\u6210\u529f\uff01")})).catch((function(e){n.setState((function(e){var t=0;e.fileList.forEach((function(n,a){console.log("preState.deletefile.uid",e.deletefile.uid),n.uid===e.deletefile.uid&&(t=a)}));var n=Object(s.a)(e.fileList);return n.splice(t,1),{fileList:Object(s.a)(n),delModalVisible:!1}})),o.a.error(e)}))},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){console.log("this.props.defaultFileList",this.props.defaultFileList)}},{key:"upload",value:function(e){console.log("informa",e)}},{key:"render",value:function(){var e=this,t=m.a.createElement("div",null,m.a.createElement(r.a,{type:"plus"}),m.a.createElement("div",{className:"ant-upload-text"},"Upload")),n=this.props,o=n.visible,l=n.onConcel,s=n.maxImgCount;return m.a.createElement(a.a,{title:"\u6587\u4ef6\u4e0a\u4f20",visible:o,onCancel:l,onOk:this.onConfirmUpload},m.a.createElement(i.a,{name:"image",listType:"picture-card",className:"avatar-uploader",fileList:this.state.fileList,action:"".concat(v.default.serverHost,"/api/image"),onChange:this.handleChange,onPreview:this.handlePreview,onRemove:this.onRemove},this.state.fileList.length>=s?null:t),m.a.createElement(a.a,{visible:this.state.previewVisible,footer:null,onCancel:function(){return e.setState({previewVisible:!1})}},m.a.createElement("img",{alt:"example",style:{width:"100%"},src:this.state.previewImage})),m.a.createElement(b.default,{handleConfirm:this.onRemoveConfirm,handleCancel:function(){e.setState({delModalVisible:!1})},visible:this.state.delModalVisible,title:"\u5220\u9664",content:this.state.deleteTitle}))}}]),t}(m.a.Component);y.defaultProps={visible:!1,maxImgCount:1,onConcel:function(){},onOk:function(){},defaultFileList:[]},t.default=y},1125:function(e,t,n){},1127:function(e,t,n){},1139:function(e,t,n){},1466:function(e,t,n){"use strict";n.r(t);var a=n(64),i=n(65),r=n(67),o=n(66),l=n(147),s=n(68),c=n(1),u=n.n(c),f=(n(1127),n(2)),d=n.n(f),p=n(1129),h=n.n(p),m=n(1130);m.registerLanguage("css",n(1131)),m.registerLanguage("json",n(1132)),m.registerLanguage("less",n(1133)),m.registerLanguage("scss",n(1134)),m.registerLanguage("javascript",n(1135)),m.registerLanguage("typescript",n(1136));var g=m;h.a.setOptions({renderer:new h.a.Renderer,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,highlight:function(e){return g.highlightAuto(e).value}});var v=new h.a.Renderer;v.paragraph=function(e){return"<p>".concat(e,"</p>")},v.link=function(e,t,n){return"<a href=".concat(e,"\n      title=").concat(t||e,"\n      target='_blank'\n      }>").concat(n,"</a>")};var b=function(e){return"string"!=typeof e?"":h()(e,{renderer:v})};function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=e.value;if(e.selectionStart||0===e.selectionStart){var r=e.selectionStart,o=e.selectionEnd,l=e.scrollTop;r===o?(e.value=i.substring(0,r)+t+n+a+i.substring(o,i.length),e.selectionStart=r+t.length,e.selectionEnd=o+t.length+n.length):(e.value=i.substring(0,r)+t+i.substring(r,o)+a+i.substring(o,i.length),e.selectionStart=r+t.length,e.selectionEnd=o+t.length),e.focus(),l>=0&&(e.scrollTop=l)}}var E={h1:function(e){y(e,"# ","\u4e00\u7ea7\u6807\u9898")},h2:function(e){y(e,"## ","\u4e8c\u7ea7\u6807\u9898")},h3:function(e){y(e,"### ","\u4e09\u7ea7\u6807\u9898")},h4:function(e){y(e,"#### ","\u56db\u7ea7\u6807\u9898")},image:function(e,t){y(e,"![alt](",t||"url",")")},link:function(e){y(e,"[title](","url",")")},code:function(e){y(e,"```","language","\n\n```")},tab:function(e){y(e,"  ")}},C=function(e,t,n){return E[t](e,n)},k=83,w=90,O=89,_=9,S=(n(1137),n(1139),n(1024)),x=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(o.a)(t).call(this,e))).handleChange=function(e){var t=e.target.value;n.saveHistory(t),n.props.onChange(t)},n.insert=function(e){var t=Object(l.a)(n).$vm,a=e.currentTarget?e.currentTarget.getAttribute("data-type"):e;C(t,a),console.log("$vm.value",t.value),n.props.onChange(t.value),n.saveHistory(t.value)},n.handleInsertImg=function(e){console.log("onOk"),n.setState({visibleUpload:!1});var t=Object(l.a)(n).$vm,a=e[0].url;C(t,"image",a),n.props.onChange(t.value),n.saveHistory(t.value)},n.undo=function(){var e=n.state.f_history,t=n.state.f_history_index;if(!((t-=1)<0)){n.setState({f_history_index:t});var a=e[t];n.props.onChange(a),n.handleLineIndex(a)}},n.redo=function(){var e=n.state.f_history,t=n.state.f_history_index;if(!((t+=1)>=e.length)){n.setState({f_history_index:t});var a=e[t];n.props.onChange(a),n.handleLineIndex(a)}},n.preview=function(){n.setState({preview:!n.state.preview})},n.expand=function(){n.setState({expand:!n.state.expand})},n.save=function(){n.props.onSave()},n.focusText=function(){Object(l.a)(n).$vm.focus()},n.getMarkedHtml=function(){var e=n.props.value;return b(e)},n.$vm=null,n.handleEditorRef=function(e){n.$vm=e},n.state={visibleUpload:!1,preview:!1,expand:!1,f_history:[],f_history_index:0,line_index:1},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e;(e=this).$vm.addEventListener("keydown",(function(t){if(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey){if((t.ctrlKey||t.metaKey)&&!t.altKey&&!t.shiftKey)switch(t.keyCode){case w:t.preventDefault(),e.undo();break;case O:t.preventDefault(),e.redo();break;case k:t.preventDefault(),e.save()}}else switch(t.keyCode){case _:t.preventDefault(),e.insert("tab")}}))}},{key:"componentWillUpdate",value:function(e,t){var n=this.state.f_history;e.value&&0===t.f_history.length&&(n.push(e.value),this.setState({f_history:n}),this.handleLineIndex(e.value))}},{key:"componentWillReceiveProps",value:function(e){e.value!==this.props.value&&this.handleLineIndex(e.value)}},{key:"saveHistory",value:function(e){var t=this,n=this.state,a=n.f_history,i=n.f_history_index;window.clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout((function(){i<a.length-1&&a.splice(i+1),a.length>=20&&a.shift(),i=a.length,a.push(e),t.setState({f_history:a,f_history_index:i})}),500),this.handleLineIndex(e)}},{key:"handleLineIndex",value:function(e){var t=e?e.split("\n").length:1;this.setState({line_index:t})}},{key:"render",value:function(){var e=this,t=this.state,n=t.preview,a=t.expand,i=t.line_index,r=this.props.value;console.log("markValue",this.props);var o=d()({"for-panel":!0,"for-preview-hidden":!n}),l=d()({"for-panel":!0}),s=d()({"for-active":n}),c=d()({"for-container":!0,"for-fullscreen":a}),f=d()({"for-active":a}),p=d()({"for-line-num":!0,hidden:!this.props.lineNum}),h="";try{n&&(h=b(r))}catch(m){console.log(m)}return u.a.createElement("div",{className:c,style:{height:this.props.height}},u.a.createElement("div",{className:"for-controlbar"},u.a.createElement("ul",null,u.a.createElement("li",{onClick:this.undo,title:"\u4e0a\u4e00\u6b65 (ctrl+z)"},u.a.createElement("i",{className:"foricon for-undo"})),u.a.createElement("li",{onClick:this.redo,title:"\u4e0b\u4e00\u6b65 (ctrl+y)"},u.a.createElement("i",{className:"foricon for-redo"})),u.a.createElement("li",{"data-type":"h1",onClick:this.insert,title:"\u4e00\u7ea7\u6807\u9898"},"H1"),u.a.createElement("li",{"data-type":"h2",onClick:this.insert,title:"\u4e8c\u7ea7\u6807\u9898"},"H2"),u.a.createElement("li",{"data-type":"h3",onClick:this.insert,title:"\u4e09\u7ea7\u6807\u9898"},"H3"),u.a.createElement("li",{"data-type":"h4",onClick:this.insert,title:"\u56db\u7ea7\u6807\u9898"},"H4"),u.a.createElement("li",{"data-type":"image",onClick:function(){e.setState({visibleUpload:!0})},title:"\u56fe\u7247"},u.a.createElement("i",{className:"foricon for-image"})),u.a.createElement("li",{"data-type":"link",onClick:this.insert,title:"\u8d85\u94fe\u63a5"},u.a.createElement("i",{className:"foricon for-link"})),u.a.createElement("li",{"data-type":"code",onClick:this.insert,title:"\u4ee3\u7801\u5757"},u.a.createElement("i",{className:"foricon for-code"}))),u.a.createElement("ul",null,u.a.createElement("li",{className:f,onClick:this.expand},f?u.a.createElement("i",{className:"foricon for-contract"}):u.a.createElement("i",{className:"foricon for-expand"})),u.a.createElement("li",{className:s,onClick:this.preview},s?u.a.createElement("i",{className:"foricon for-eye-off"}):u.a.createElement("i",{className:"foricon for-eye"})))),u.a.createElement("div",{className:"for-editor"},u.a.createElement("div",{className:l,tabIndex:"-1",onFocus:this.focusText},u.a.createElement("div",{className:"for-editor-wrapper"},u.a.createElement("div",{className:"for-editor-block"},function(){for(var e=[],t=0;t<i;t++)e.push(u.a.createElement("li",{key:t+1},t+1));return u.a.createElement("ul",{className:p},e)}(),u.a.createElement("div",{className:"for-editor-content"},u.a.createElement("pre",null,r," "),u.a.createElement("textarea",{ref:this.handleEditorRef,value:r,onChange:this.handleChange,placeholder:this.props.placeholder}))))),u.a.createElement("div",{className:o},u.a.createElement("div",{className:"for-preview for-markdown-preview",dangerouslySetInnerHTML:{__html:h}}))),u.a.createElement(S.default,{visible:this.state.visibleUpload,onConcel:function(){return e.setState({visibleUpload:!1})},onOk:this.handleInsertImg}))}}]),t}(u.a.Component);x.defaultProps={placeholder:"\u8bf7\u8f93\u5165\u5185\u5bb9...",lineNum:!0};t.default=x},1469:function(e,t,n){"use strict";var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(186),l=n(501),s=n(151),c=n(985),u=n(942),f=n(942);n(1125);var d=n(1466),p=n(912),h=n(1024),m=n(111),g=n(96),v=n(1145),b=o.Select.Option,y=o.Radio.Group,E=o.Checkbox.Group,C={visibleUpload:!1,defaultFileList:[]},k=function(e){function t(t){var n=e.call(this,t)||this;return n.state=C,n.handleSubmit=function(e){e.preventDefault();var t=Object.assign({},n.props.article.singleArticle),a=n.markdownRef.current.getMarkedHtml();t.content=a;var i=new Date,r=c.default.toFormat(i,"yyyy-MM-dd hh:mm:ss");t.date=r,t.type="post",console.log("article",t),t.id?p.addArticle(t,t.id).then((function(e){e.id&&o.message.success("\u4fee\u6539\u6210\u529f!",(function(){n.props.history.push("/article/table")}))})):p.addArticle(t).then((function(e){e.id&&o.message.success("\u65b0\u589e\u6210\u529f!",(function(){n.props.history.push("/article/table")}))}))},n.onChangeStatus=function(e){e.preventDefault()},n.onChangeInput=function(e,t){var a={};a[e]=t.target.value,n.props.changeArticle(a)},n.onChangeRec=function(e){n.props.changeArticle({recommend:e})},n.onChangeTags=function(e){var t=e;console.log("tags",t),n.props.changeArticle({tag:t})},n.onChangeCate=function(e){n.props.changeArticle({category_id:e})},n.onChangeMarkdown=function(e){n.props.changeArticle({markdown:e})},n.confirmUpload=function(e){n.setState({visibleUpload:!1}),e.length>0?n.props.changeArticle({thumb:e[0].url}):n.props.changeArticle({thumb:""})},n.toContent=function(){n.props.history.push("/article/table")},n.markdownRef=r.createRef(),n}return a(t,e),t.prototype.componentDidMount=function(){this.props.fetchTags({type:"tag"});var e=v.parse(this.props.location.search).id;e&&this.props.fetchSingleArt({id:e})},t.prototype.render=function(){var e=this;console.log("this.props",this.props);var t="\u4e0a\u4f20\u56fe\u7247";this.props.thumb&&this.props.thumb!=l.default.serverHost&&(t="\u4fee\u6539\u4e0a\u4f20\u56fe\u7247");var n=this.props.form.getFieldDecorator,a=this.props.tag,s=this.props.tags.map((function(e){return{label:e.name,value:e.id}}));return r.createElement("div",null,r.createElement(o.Form,i({},{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},{className:"editForm",onSubmit:this.handleSubmit}),r.createElement(o.Form.Item,{label:"\u6587\u7ae0\u6807\u9898"},n("title",{initialValue:this.props.title,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6807\u9898"}]})(r.createElement(o.Input,{placeholder:"\u8bf7\u8f93\u5165\u6587\u7ae0\u6807\u9898",autoComplete:"off",onChange:function(t){e.onChangeInput("title",t)}}))),r.createElement(o.Form.Item,{label:"\u662f\u5426\u8bbe\u4e3a\u7279\u522b\u63a8\u8350"},n("recommend",{initialValue:this.props.recommend})(r.createElement(o.Select,{onChange:this.onChangeRec},r.createElement(b,{value:"Y"},"\u662f"),r.createElement(b,{value:"N"},"\u5426")))),r.createElement(o.Form.Item,{label:"\u7f29\u7565\u56fe"},n("thumb",{initialValue:this.props.thumb})(r.createElement(o.Button,{onClick:function(){e.setState({visibleUpload:!0})}},t))),r.createElement(o.Form.Item,{label:"\u6587\u7ae0\u5206\u7c7b"},n("category_id",{initialValue:this.props.categoryId})(r.createElement(o.Select,{onChange:this.onChangeCate},r.createElement(b,{value:1},"tech"),r.createElement(b,{value:2},"life"),r.createElement(b,{value:2},"life")))),r.createElement(o.Form.Item,{label:"\u72b6\u6001"},n("status",{initialValue:this.props.status,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6587\u7ae0\u72b6\u6001"}]})(r.createElement(y,{onChange:function(t){e.onChangeInput("status",t)}},r.createElement(o.Radio,{value:0},"\u8349\u7a3f"),r.createElement(o.Radio,{value:99},"\u53d1\u5e03")))),r.createElement(o.Form.Item,{label:"\u6807\u7b7e"},n("tag",{initialValue:a})(r.createElement(E,{options:s,onChange:this.onChangeTags}))),r.createElement(o.Form.Item,{label:"\u6587\u7ae0\u5185\u5bb9"},n("markdown",{initialValue:this.props.markdown})(r.createElement(d.default,{onChange:this.onChangeMarkdown,ref:this.markdownRef}))),r.createElement(o.Form.Item,i({},{wrapperCol:{xs:{span:24,offset:0},sm:{span:20,offset:4}}}),r.createElement(o.Button,{type:"primary",htmlType:"submit"},"\u786e\u5b9a"),r.createElement(o.Button,{type:"primary",style:{marginLeft:"20px"},onClick:this.toContent},"\u53d6\u6d88"))),r.createElement(h.default,{visible:this.state.visibleUpload,onConcel:function(){e.setState({visibleUpload:!1})},onOk:this.confirmUpload,key:this.props.thumb,maxImgCount:1,defaultFileList:this.props.thumb&&this.props.thumb!=l.default.serverHost?[{uid:"-1",url:this.props.thumb}]:[]}))},t}(r.Component),w=o.Form.create({name:"edit-form"})(k),O=s.connect((function(e){return{title:e.article.singleArticle.title,sign:e.article.singleArticle.sign,thumb:e.article.singleArticle.thumb,date:e.article.singleArticle.date,status:e.article.singleArticle.status,tag:e.article.singleArticle.tag,article:e.article,tags:e.article.tags,categoryId:e.article.singleArticle.category_id,createTime:e.article.singleArticle.create_time,recommend:e.article.singleArticle.recommend,markdown:e.article.singleArticle.markdown}}),(function(e){return m.bindActionCreators({changeArticle:function(e){return f.articleChange(e)},articleClear:function(e){return f.articleClear(i({},e))},fetchTags:function(e){return u.setTags(i({},e))},fetchSingleArt:function(e){return f.fetchListData(i({},e))}},e)}));t.default=g.withRouter(O(w))},912:function(e,t,n){"use strict";n.r(t),n.d(t,"getContent",(function(){return r})),n.d(t,"deleteArticle",(function(){return o})),n.d(t,"addArticle",(function(){return l})),n.d(t,"deleteFile",(function(){return s})),n.d(t,"deleteTag",(function(){return c})),n.d(t,"postTag",(function(){return u}));var a=n(242),i=n.n(a);function r(e){return i()({url:"/api/content",method:"get",data:e})}function o(e){var t=e.id;return i()({url:"/api/content/"+t,method:"delete"})}function l(e,t){return i()({url:t?"/api/content/"+t:"/api/content",method:"post",data:e})}function s(e){return i()({url:"/api/image",method:"delete",data:{filepath:e}})}function c(e){return i()({url:"/api/meta",method:"delete",data:e})}function u(e){return i()({url:"/api/meta",method:"post",data:e})}},942:function(e,t,n){"use strict";n.r(t),n.d(t,"getData",(function(){return s})),n.d(t,"fetchListData",(function(){return c})),n.d(t,"setTags",(function(){return u})),n.d(t,"articleChange",(function(){return f})),n.d(t,"articleClear",(function(){return d}));var a=n(244),i=n(502),r=n(242),o=n.n(r),l=n(148);function s(e){return o()({url:"/api/content1",method:"get",data:e})}function c(e){return function(t){return o()({url:"/api/content",method:"get",data:e}).then((function(e){e.data instanceof Array?t(Object(l.action)(i.SEARCH_LIST,e)):t(Object(l.action)(i.CHANGE_ARTICLE,Object(a.a)({},e,{tag:e.tag.map((function(e){return e.id}))})))})).catch((function(e){console.error("err",e)}))}}function u(e){return function(t){return o()({url:"/api/meta",method:"get",data:e}).then((function(e){t(Object(l.action)(i.SET_TAGS,e))})).catch((function(e){console.error("err",e)}))}}function f(e){return function(t){t(Object(l.action)(i.CHANGE_ARTICLE,e))}}function d(e){return function(t){t(Object(l.action)(i.CLEAR_ARTICLE,e))}}},943:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));n(933);var a=n(243),i=n(64),r=n(65),o=n(67),l=n(66),s=n(68),c=n(1),u=n.n(c),f=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props.title,t=this.props.content,n=this.props.visible;return u.a.createElement("div",null,u.a.createElement(a.a,{title:e,visible:n,onOk:this.props.handleConfirm,onCancel:this.props.handleCancel},t))}}]),t}(u.a.Component)},985:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={toFormat:function(e,t){void 0===t&&(t="yyyy-MM-dd hh:mm:ss");var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[a]:("00"+n[a]).substr((""+n[a]).length)));return t}};t.default=a}}]);